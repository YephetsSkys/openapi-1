#网关
##1 网关的作用
```
在我们的项目中,网关是一个统一的入口,
在这里我们需要进行各种校验,判断,限制,策略等处理,最后通过后转发到用户请求的服务
```
###1.1 如何知道用户访问的服务是什么?
```
按照之前的写法,我们需要在配置文件中配置路径和服务之间的映射关系,
但是如果服务的列表发生变化,我们需要更新配置文件
以上方式可以实现我们的需求,但是不专业,不智能,因为可能会频繁的需要更新配置文件
如果能通过一套统一的代码来进行处理 则更好
```
###1.2 规则
```
既然是通过一套统一的代码,那么就必须有规则,规则是什么,怎么定
此处的规则是我们的项目中的问题,目的是知道访问什么服务,主要是用来取代配置文件
那我们猜测,我们的规则也主要是地址和服务之间的映射关系

```
1. 映射关系结构是怎么样的
服务中有服务的名字,再有一个就是里面的接口地址,所以实际包含是两部分,服务名和地址
2. 保存到什么地方
我们期望达到动态映射的目的,所以映射保存的位置必须是多个人都能访问到的地方,经过比较,放到redis中
3. 在redis中怎么存
redis是key-value ,key用什么,value 的结构是什么, key应该是一个标记,是什么不是由客户端决定的,而是服务端提前定义好,客户端传递的,所以这个key可以随便写,只有唯一且可以找得到就行
value因为放了多个数据,所以是hash


##网关流程
我们需要让用户先登录,然后携带一些登录数据过来,然后我们需要对用户的身份进行校验,客户端传递的数据都不可信,所以我们需要校验
如何校验
如果不校验: 假如你在淘宝买了一个笔记本,两万快,使用支付宝付款,然后我们会向支付宝发起请求,请求扣款2万,支付宝就扣款了,
如果支付宝不做校验,请求就可以修改,把价格改成1分,如果不校验的话就只口1分,那就惨了
有规则:
    如果用户修改了数据我们还能判断出来,说明一定有地方和原先的不一样,而且这东西用户还弄不出来
    大部分网站都使用签名进行校验,也就是将所有的请求参数按照特定的顺序排序后生成指定的值,然后再拼接到请求参数中,传递到服务器
    name=zhangsan1&pwd=123456&timestamp=2019-12-02&key=dasdasdasdasdasdasdas&sign=fadsfdsfadsfasdfasdff
    
##程序启动时候加载数据的问题
1. 可以通过servletcontextlistener来初始化数据,因为这个对象随着tomcat启动而创建
2. 我们其实也可以利用spring来完成,spring会随着tomcat启动而初始化对象,我们可以在对象的初始化过程中指定initmethod

#次数限制的问题
a接口免费次数50次,任何人刚来的时候都是50次,每个人单独的数据什么时候出现的,而且注意这个50次可能是终身的,而有的是可能会定期恢复的
如果接口每个月都会恢复50次,是在原先的基础上加50还是变成50,付费用户怎么处理的
次数保存的时候就分为免费次数和收费次数,如果是不管37=21直接加50 你还需要注意一个问题,我们判断用户是否还有剩余的标准是每次减1得到的结果>0就行,所以一旦超出次数后用户再访问会导致数据越来越小,最后月初加50可能还是负数,导致仍旧不能访问